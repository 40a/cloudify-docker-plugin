# DSL version, should appear in the main blueprint.yaml
# and may appear in other imports. In such case, the versions must match
tosca_definitions_version: cloudify_dsl_1_0

imports:
  - http://www.getcloudify.org/spec/cloudify/3.2m2/types.yaml
  - ../../../plugin.yaml

inputs:
  test_repo:
    type: string

  test_tag:
    type: string

  test_container_name:
    type: string
    default: ''

node_templates:
  test_image:
    type: cloudify.docker.RepositoryImage
    properties:
      repository: { get_input: test_repo }
      tag: { get_input: test_tag }
      install_agent: false
      params:
        stream: true
        insecure_registry: false
    relationships:
      - type: cloudify.relationships.contained_in
        target: host

  test_container:
    type: cloudify.docker.Container
    properties:
      use_external_resource: false
      name: { get_input: test_container_name }
      image: { get_property: [ test_image, repository ] }
      install_agent: false
      ports:
        22: 22
        80: 80
      params:
        stdin_open: true
        tty: true
        command: /bin/sleep 30
    relationships:
      - type: cloudify.docker.container_depends_on_image
        target: test_image
      - type: cloudify.relationships.contained_in
        target: host

  host:
    type: cloudify.nodes.Compute
    properties:
      ip: localhost
      install_agent: false
